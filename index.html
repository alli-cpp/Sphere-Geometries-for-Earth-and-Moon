<html>
  <head>
    <script type="text/javascript" src="https://getfirebug.com/firebug-lite-debug.js"></script>
    <meta name="description" content="CS4406 Computer Graphics - Exercise #6" />
    <meta charset="utf-8" />
    <title>Assignment UNIT # 6, Earth and Moon</title>
    <style>
      #container {
        background: #ffffff;
        width: 100%;
        height: 100vh; /* Full viewport height */
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
    <script src="http://uopeopleweb.com/js/dat.gui.min.js"></script>
    <script src="https://threejs.org/build/three.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/controls/OrbitControls.js"></script>
    <script src="http://uopeopleweb.com/js/math.js"></script>
    <script src="http://uopeopleweb.com/js/Detector.js"></script>
    <script type="text/javascript">
      var WIDTH = window.innerWidth, // Dynamically set to window size
        HEIGHT = window.innerHeight;

      var VIEW_ANGLE = 20,
        ASPECT = WIDTH / HEIGHT,
        NEAR = 1,
        FAR = 1000;

      var $container = $('#container');

      // create the renderer
      var renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(WIDTH, HEIGHT);
      $container.append(renderer.domElement);

      var scene = new THREE.Scene();
      var clock = new THREE.Clock();

      // create the camera and add to the scene
      var camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);
      camera.position.z = 600;
      scene.add(camera);

      // Controls
      var cameraControls = new THREE.OrbitControls(camera, renderer.domElement);
      cameraControls.enabled = false;

      // Add light
      var light = new THREE.DirectionalLight(0xfdfcf0, 1);
      light.position.set(100, 0, 80);
      light.castShadow = true;
      scene.add(light);

      // Create the Earth and Moon
      var earthGeometry = new THREE.SphereGeometry(50, 50, 50);
      var earthMaterial = new THREE.MeshPhongMaterial({
        map: new THREE.TextureLoader().load("https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/The_Earth_seen_from_Apollo_17.jpg/300px-The_Earth_seen_from_Apollo_17.jpg"),
        color: 0xaaaaaa,
        specular: 0x333333,
        shininess: 10
      });
      var earth = new THREE.Mesh(earthGeometry, earthMaterial);
      scene.add(earth);
      earth.receiveShadow = true;
      earth.castShadow = true;

      var moonGeometry = new THREE.SphereGeometry(15, 50, 50);
      var moonMaterial = new THREE.MeshPhongMaterial({
        map: new THREE.TextureLoader().load("https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/FullMoon2010.jpg/280px-FullMoon2010.jpg"),
        color: 0xaaaaaa,
        specular: 0x333333,
        shininess: 10
      });
      var moon = new THREE.Mesh(moonGeometry, moonMaterial);
      moon.position.x = 70;
      scene.add(moon);
      moon.receiveShadow = true;
      moon.castShadow = true;

      var r = 70;
      var theta = 0;
      var dTheta = 0.8 * Math.PI / 100;

      // Debugging: log if renderer and scene are ready
      console.log("Renderer and scene are set up");

      function animate() {
        requestAnimationFrame(animate);
        render();
      }

      function render() {
        cameraControls.update();
        earth.rotation.y += 0.01;
        moon.rotation.y -= 0.03;
        theta -= dTheta;
        moon.position.x = r * Math.cos(theta);
        moon.position.z = r * Math.sin(theta);
        renderer.render(scene, camera);
      }

      animate();
    </script>
  </body>
</html>
